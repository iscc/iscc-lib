# mise.toml — task runner and tool versions for iscc-lib
#
# Usage: mise run <task>

# --- CID (Continuous Iterative Development) ---

[tasks."cid:run"]
description = "Run CID loop until done or max iterations (default: 20)"
run = "uv run tools/cid.py --skip-permissions run --max-iterations {{arg(name='n', i=0, default='20')}} --pause {{arg(name='pause', i=1, default='1200')}}"

[tasks."cid:step"]
description = "Run one full CID iteration (update-state → define-next → advance → review)"
run = "uv run tools/cid.py --skip-permissions step"

[tasks."cid:status"]
description = "Show current project state from state.md"
run = "uv run tools/cid.py status"

[tasks."cid:stats"]
description = "Show iteration log summary statistics"
run = "uv run tools/cid.py stats"

[tasks."cid:state"]
description = "Run update-state agent only"
run = "uv run tools/cid.py --skip-permissions role update-state"

[tasks."cid:next"]
description = "Run define-next agent only"
run = "uv run tools/cid.py --skip-permissions role define-next"

[tasks."cid:advance"]
description = "Run advance agent only"
run = "uv run tools/cid.py --skip-permissions role advance"

[tasks."cid:review"]
description = "Run review agent only"
run = "uv run tools/cid.py --skip-permissions role review"

# --- Quality ---

[tasks.check]
description = "Run all pre-commit hooks on all files"
run = "uv run prek run --all-files"

[tasks.lint]
description = "Run format checks, clippy, and ruff"
run = """
cargo fmt --all --check &&
cargo clippy --workspace --all-targets -- -D warnings &&
uv run ruff check &&
uv run ruff format --check
"""

[tasks.format]
description = "Apply all formatting"
run = """
cargo fmt --all &&
uv run ruff check --fix &&
uv run ruff format &&
uv run taplo fmt &&
uv run yamlfix .
"""

[tasks.test]
description = "Run all tests"
run = """
cargo test --workspace &&
uv run pytest
"""
